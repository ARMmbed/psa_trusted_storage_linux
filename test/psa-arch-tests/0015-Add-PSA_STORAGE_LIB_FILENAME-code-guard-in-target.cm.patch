From b47c4c8e34b75d25141b9134b225693caf8de5e6 Mon Sep 17 00:00:00 2001
From: Simon Hughes <simon.hughes@arm.com>
Date: Wed, 20 Nov 2019 13:27:22 +0000
Subject: [PATCH 15/15] Add PSA_STORAGE_LIB_FILENAME code guard in target.cmake
 _create_psa_stdc_exe().

---
 api-tests/platform/targets/tgt_dev_apis_stdc/target.cmake | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/api-tests/platform/targets/tgt_dev_apis_stdc/target.cmake b/api-tests/platform/targets/tgt_dev_apis_stdc/target.cmake
index aa83344..d3ac97a 100644
--- a/api-tests/platform/targets/tgt_dev_apis_stdc/target.cmake
+++ b/api-tests/platform/targets/tgt_dev_apis_stdc/target.cmake
@@ -40,11 +40,13 @@ function(_create_psa_stdc_exe _exe_name _api_dir)
 	# Create the PSA test binary.
 	set(EXE_NAME ${_exe_name})
 
-	# Define PSA_STORAGE_LIB_NAME to be the name of the PSA Storage library to be tested.
-	get_filename_component(PSA_STORAGE_LIB_NAME ${PSA_STORAGE_LIB_FILENAME} NAME)
+	if(DEFINED PSA_STORAGE_LIB_FILENAME)
+		# Define PSA_STORAGE_LIB_NAME to be the name of the PSA Storage library to be tested.
+		get_filename_component(PSA_STORAGE_LIB_NAME ${PSA_STORAGE_LIB_FILENAME} NAME)
 
-	get_filename_component(PSA_STORAGE_LIB_DIR ${PSA_STORAGE_LIB_FILENAME} DIRECTORY)
-	link_directories(${PSA_STORAGE_LIB_DIR})
+		get_filename_component(PSA_STORAGE_LIB_DIR ${PSA_STORAGE_LIB_FILENAME} DIRECTORY)
+		link_directories(${PSA_STORAGE_LIB_DIR})
+	endif()
 
 	if(DEFINED PSA_CRYPTO_LIB_FILENAME)
 		# Define PSA_CRYPTO_LIB_NAME to be the name of the PSA Crypto library to be tested.
-- 
2.7.4

